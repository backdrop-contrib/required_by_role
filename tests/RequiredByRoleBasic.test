<?php

/**
 * @file
 * Tests for Required by role module.
 */

/**
 * Base class for all required by role web test cases.
 */
abstract class RequiredByRoleBasic extends DrupalWebTestCase {

  protected $entity_type = 'node';
  protected $entity_bundle = 'article';

  protected $basePermissions = array();
  protected $required_fields_rid = NULL;

  protected function setUp() {

    $this->basePermissions = array(
      'access content',
      'create ' . $this->entity_bundle . ' content',
      'edit any ' . $this->entity_bundle . ' content',
      'administer content types',
      'administer nodes',
      'administer filters',
      'access comments',
      'post comments',
      'access administration pages',
    );

    $modules = array();
    $modules[] = 'field';
    $modules[] = 'field_ui';
    $modules[] = 'required_by_role';

    parent::setUp($modules);

    // Create Basic page and Article node types.
    if ($this->profile != 'standard') {
      $this->drupalCreateContentType(array('type' => $this->entity_bundle, 'name' => 'Article'));
    }

    module_load_include('inc', 'field', 'field.crud');
    module_load_include('inc', 'node', 'node.pages');

    // Create a role for required fields
    $this->required_fields_rid = $this->drupalCreateRole($this->basePermissions, 'Required fields role');
  }

  protected function getRequiredUser(){

    $account = $this->drupalCreateUser($this->basePermissions);

    $edit = array();
    $edit['roles'] = array($this->required_fields_rid => $this->required_fields_rid);

    return user_save($account, $edit);

  }

  protected function getNonRequiredUser(){
    return $this->drupalCreateUser($this->basePermissions);
  }

}
